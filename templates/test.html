<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>位置流量趋势</title>
        {% load static %}
        <link rel="stylesheet" href="../static/css/semantic.min.css">
        <link rel="stylesheet" href="../static/css/style.min.css">
        <script src="https://d3js.org/d3.v5.js"></script>
        <script type="text/javascript" src="../static/js/manhadun.js"></script>
        <script type="text/javascript" src="../static/js/jquery-3.5.1.min.js"></script>
        <link rel="stylesheet" type="text/css" href="../static/css/style.css">
    </head>
    <body>
        <div class="ui fixed main menu header">
            <div class="container header_container">
                <div class="header_container_left">
                    <a class="header_container_left_title" href="http://47.95.147.13:9999/homepage/">交通可视化</a>
                    <a href="http://47.95.147.13:9999/homepage/" class="header_container_left_nav">首页</a>
                    <a href="http://47.95.147.13:9999/overview/" class="header_container_left_nav">概述</a>
                    <a href="http://47.95.147.13:9999/traffic_trend/" class="header_container_left_nav">位置流量趋势图</a>
                    <a href="http://47.95.147.13:9999/heatmap/" class="header_container_left_nav">区域热力图</a>
                    <a href="http://47.95.147.13:9999/api/" class="header_container_left_nav">数据接口</a>
                </div>
            </div>
            
            <div class="body" style="position:relative;top:0px;margin: 0px;">
                <div id = "tu" class="root1">
                    <div class="show_msg">
                        <div class="msg_hen">
                            <a id = "unionsq" class="header_container_left_nav" style="font-size: 20px;">Union Sq</a>
                            <a id = "timesq" class="header_container_left_nav" style="font-size: 20px;">Time Sq</a>
                            <a id = "murry" class="header_container_left_nav" style="font-size: 20px;">Murry Hill</a>
                        </div>
                        

                        <!-- union_sq_table -->
                        <div id = "union_sq_table" style="display:none;">
                            <table>
                                <tr>
                                  <th>Area</th>
                                  <th>heat</th>
                                </tr>
                                <tr>
                                  <td>DUMBO/Vinegar Hill</td>
                                  <td>23.1%</td>
                                </tr>
                                <tr>
                                  <td>Brooklyn Heights</td>
                                  <td>15.5%</td>
                                </tr>
                                <tr>
                                  <td>East Harlem South</td>
                                  <td>10.0%</td>
                                </tr>
                                <tr>
                                  <td>Winecellarsiamsburg(North Side)</td>
                                  <td>9.8%</td>
                                </tr>
                                <tr>
                                  <td>Long Island City/Hunters Point</td>
                                  <td>7.8%</td>
                                </tr>
                                <tr>
                                  <td>Downtown Brooklyn/MetroTech</td>
                                  <td>7.2%</td>
                                </tr>
                                <tr>
                                    <td>Central Harlem</td>
                                    <td>7.1%</td>
                                  </tr>
                                  <tr>
                                    <td>Momingside Heights</td>
                                    <td>6.6%</td>
                                  </tr>
                                  <tr>
                                    <td>Washington Heights South</td>
                                    <td>6.5%</td>
                                  </tr>
                                  <tr>
                                    <td>Fort Greene</td>
                                    <td>6.4%</td>
                                  </tr>
                              </table>
                        </div>

                    </div>
                    <div class="svg_sty">
                        <svg class="chart">
                            <defs>
                                <mask id="Mask0">
                                    <circle id="circle0" r="150" fill="url(#grad)"  />
                                </mask>
                                <mask id="Mask1">
                                    <circle id="circle1" r="150" fill="url(#grad)"  />
                              </mask>
                
                                <radialGradient
                                    id="grad"
                                    cx="0.5"
                                    cy="0.5"
                                    r="0.5" >
                                    <stop offset="0%" stop-color="#fff" stop-opacity='1'/>
                                    <stop offset="100%" stop-color="#fff" stop-opacity='0' />
                                </radialGradient>
                            </defs>
                
                            <filter id="inLight" x="-50%" y="-50%" width="200%" height="200%">
                                <feComponentTransfer in=SourceAlpha>
                                  <feFuncA type="table" tableValues="1 0" />
                                </feComponentTransfer>
                                <feGaussianBlur stdDeviation="4"/>
                                <feOffset dx="0" dy="1" result="offsetblur"/>
                                <feFlood flood-color="#d9f939" result="color"/>
                                <feComposite in2="offsetblur" operator="in"/>
                                <feComposite in2="SourceAlpha" operator="in" />
                                <feMerge>
                                  <feMergeNode in="SourceGraphic" />
                                  <feMergeNode />
                                </feMerge>
                            </filter>
                
                            <filter id="outLight" x="-50%" y="-50%"  width="200%" height="200%">
                                <feDropShadow dx="0" dy="0" stdDeviation="10" flood-color="hsla(180,90%,40%,0.9)" />
                            </filter>
                        </svg>
                    </div>
                </div>
            </div>
        </body>
<script>
    
    /**
     * 基本配置 
     */
    const svgWidth = 1100;
    const svgHeight = 600;
    const padding = 0;

    const svg = d3.select(".chart")
        .attr("height", svgHeight)
        .attr("width", svgWidth)
        .style("background","#123456");

    const x0 = padding;
    const y0 = padding;
    const x1 = svgWidth - padding * 2;
    const y1 = svgHeight - padding * 2;
    const projection = d3.geoMercator().fitExtent(
        [
            [x0, y0],
            [x1, y1],
        ], man_zones);

    const pathGenerator = d3.geoPath().projection(projection); //配置上投影
    // 定义地理路径生成器
    const mapContainer = svg.append("g"); //添加mapContainer装载地图绘制内容
    // 加载地图内容
    console.log(man_zones.features["39"]);
    f = man_zones.features
    d = [
            f[0],
            f[1]
        ];
    const mapPath = mapContainer.selectAll("path")
        .data(f[0]) //数据绑定
        .join("path")
        .attr("d", pathGenerator) //绘制path
        .attr("stroke-width", 0.5)
        .attr("stroke", "#2F90A1")
        .attr("fill", "#062031");

    // // 地图缩放
    // function zoomed() {
    //     const t = d3.event.transform;
    //     mapContainer.attr("transform", `translate(${t.x}, ${t.y}) scale(${t.k})`); //改变mapContainer的位置及缩放
    // }
    // const zoom = d3.zoom()
    //             .scaleExtent([1, 3])  //设置监听范围
    //             .on("zoom", zoomed);  //设置监听事件
        
    // svg.call(zoom); //应用

   
    //`M${x1}, ${y1} Q${x},${y} ${p.x}, ${p.y}`
$('#unionsq').click(function(){
    $('#time_sq_table').hide();
    $('#murry_table').hide();
    $('#union_sq_table').show();
    window.ttype = "b";
    animate();
})

$('#timesq').click(function(){
    $('#time_sq_table').show();
    $('#murry_table').hide();
    $('#union_sq_table').hide();
    window.ttype = "a";
    animate();
})

$('#murry').click(function(){
    $('#time_sq_table').hide();
    $('#murry_table').show();
    $('#union_sq_table').hide();
    window.ttype = "c";
    animate();
})

</script>
</html>